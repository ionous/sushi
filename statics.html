<hsm-state name="Statics" hsm-init="turn.paused() && 'StaticsPause'" hsm-enter="player.linkup()">
  <hsm-state name="StaticsPlay" mouse-target="mouseTarget" hsm-enter="mouseTarget.bind(map)" hsm-exit="mouseTarget.release()" hsm-init="modal.showing() && 'StaticsModal'">
    <!--  note: without an initial show, the mouse requires a target change to become visible. -->
    <hsm-state name="StaticTargeting" hsm-enter="mouse.show('pointer')">
      <hsm-event on="update-game" run="mouseTarget.update(mouse.pos())"></hsm-event>
      <hsm-event on="mouse-target-changed" run="mouse.showTarget($evt.target)"></hsm-event>
      <!-- 
      FIX: doesnt work well for zoomed in views, the player changes size.
      <hsm-event on="hover-press" run="player.facePos($evt.pos)"></hsm-event>
       -->
      <hsm-event on="hover-press" run="actionBar.dismiss('press')"></hsm-event>
      <hsm-event on="hover-select" when="mouseTarget()" run="actionBar.open(mouseTarget(), combiner.item())"></hsm-event>
      <hsm-event on="action-bar-opened" goto="StaticsActions"></hsm-event>
      <!--  -->
      <hsm-state name="StaticsPlanning"></hsm-state>
      <!-- ^~StaticsPlanning -->
      <hsm-state name="StaticsActions" hsm-enter="mouseTarget.ghost(actionBar.target())" hsm-exit="mouseTarget.ghost(false)">
        <hsm-state hsm-exit="actionBar.dismiss('statics')" hsm-init="mouse.hidden() && 'ActionMouseHidden'">
          <hsm-event on="modal-opened" goto=""></hsm-event>
          <hsm-event on="action-bar-closed" goto="StaticsPlanning"></hsm-event>
        </hsm-state>
      </hsm-state>
      <!-- ^~StaticsActions -->
    </hsm-state>
    <!--  ^~StaticTargeting -->
    <hsm-event on="modal-opened" goto="StaticsModal"></hsm-event>
    <hsm-state name="StaticsModal">
      <hsm-event on="modal-closed" goto="StaticsPlay"></hsm-event>
    </hsm-state>
    <!-- ^~StaticsModal -->
  </hsm-state>
  <!-- ^~StaticsPlay -->
  <hsm-event on="turn-paused" goto="StaticsPause"></hsm-event>
  <hsm-state name="StaticsPause">
    <hsm-event on="turn-playing" goto="StaticsPlay"></hsm-event>
  </hsm-state>
  <!-- ^~StaticsPause -->
</hsm-state>
