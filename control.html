<!-- player avatar control -->
<hsm-state>
  <hsm-event on="interact" run="avatar.onLandingPads($evt.target) ? 'Interact' : 'Plan'"></hsm-event>
  <hsm-state name="Plan">
    <hsm-event on="direct" goto="Directing"></hsm-event>
    <hsm-event on="approach" run="avatar.onLandingPads($evt.target) ? 'Interact' : 'Pathing'"></hsm-event>
  </hsm-state>
  <!-- displaying the action bar -->
  <hsm-state name="Interact">
    <!-- action-bar="bar" hsm-exit="bar.close(), mouse.setGhost(null)" hsm-enter="bar.open($evt.where, $evt.target), mouse.setGhost($evt.target)" -->
    <!-- FIX FIX FIX -->
    <hsm-event on="ga-key" when="$evt.escapeKey()" goto="Plan"></hsm-event>
  </hsm-state>
  <!-- move the avatar to a specific target until interrupted-->
  <hsm-state name="Pathing" move-control="pathing" hsm-enter="pathing.start(avatar, $evt.target)" hsm-exit="pathing.stop()">
    <hsm-event on="ga-key" when="$evt.escapeKey()" goto="Plan"></hsm-event>
    <hsm-event on="ga-key" when="$evt.moveKey()" goto="Plan"></hsm-event>
    <hsm-event on="mousedown" goto="Plan"></hsm-event>
    <hsm-event on="move-arrived" run="avatar.interact(pathing.target)"></hsm-event>
    <hsm-event on="move-blocked" run="avatar.interact(pathing.target)"></hsm-event>
    <hsm-event on="ga-update" run="pathing.update($evt.dt)"></hsm-event>
    <!-- maybe move-blocked? -->
  </hsm-state>
  <!-- move the avatar towards the mouse so long as the mouse is held down -->
  <hsm-state name="Directing" move-control="director" hsm-enter="director.start(avatar)" hsm-exit="director.stop()">
    <hsm-state hsm-enter="mouseTarget.ghost(avatar.object)" hsm-exit="mouseTarget.ghost(false)">
      <hsm-event on="mouseTargetChanged" run="$evt.target ? 'PlayerDirectTarget' : 'PlayerDirectPos'"></hsm-event>
      <hsm-event on="mouseup" goto="Plan"></hsm-event>
      <hsm-event on="ga-update" run="director.update($evt.dt)"></hsm-event>
      <hsm-state name="PlayerDirectDefault"></hsm-state>
      <hsm-state name="PlayerDirectTarget" hsm-enter="director.setTarget($evt.target)">
        <hsm-event on="mouseup" run="avatar.interact(director.target)"></hsm-event>
      </hsm-state>
      <hsm-state name="PlayerDirectPos" hsm-enter="director.setPos(mouse.pos())">
        <hsm-event on="mousemove" run="director.setPos(mouse.pos())"></hsm-event>
      </hsm-state>
    </hsm-state>
  </hsm-state>
</hsm-state>
